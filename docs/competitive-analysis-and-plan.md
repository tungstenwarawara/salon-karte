# salon-karte エコシステム計画書

> 更新日: 2026-02-19（v3 — 在庫管理詳細設計・確定申告サポート・工数改訂）

---

## 目次

1. [実装済み機能一覧](#1-実装済み機能一覧)
2. [競合調査](#2-競合調査)
3. [料金プラン設計](#3-料金プラン設計)
4. [差別化ポイント](#4-差別化ポイント)
5. [アーキテクチャ設計方針 — 3プロダクト体制](#5-アーキテクチャ設計方針--3プロダクト体制)
6. [UI/UX改善計画](#6-uiux改善計画)
7. [在庫管理 詳細設計](#7-在庫管理-詳細設計)
8. [開発ロードマップ（改訂版）](#8-開発ロードマップ改訂版)
9. [各プロダクト仕様・見積もり](#9-各プロダクト仕様見積もり)
10. [技術スタック](#10-技術スタック)

---

## 1. 実装済み機能一覧

### コア機能（基本プランに含まれる）

| カテゴリ | 機能 | 状態 |
|---------|------|------|
| 顧客管理 | 一覧（カナ検索・ソート・離脱アラート色分け） | ✅ 実装済み |
| | 新規登録・編集・削除 | ✅ 実装済み |
| | 詳細（来店分析・売上サマリー） | ✅ 実装済み |
| 施術カルテ | 作成・詳細・編集・削除 | ✅ 実装済み |
| | ビフォーアフター写真（分類・メモ付き、5GB） | ✅ 実装済み |
| 予約管理 | 一覧（日別/週別ビュー） | ✅ 実装済み |
| | 新規・編集・ステータス管理・重複チェック | ✅ 実装済み |
| | 複数メニュー選択・終了時間自動計算 | ✅ 実装済み |
| | 営業時間設定・空き時間スロット表示 | ✅ 実装済み |
| | 休業日警告・営業時間外警告 | ✅ 実装済み |
| 売上管理 | 月間売上集計（施術/物販/回数券） | ✅ 実装済み |
| | 顧客単位の売上サマリー | ✅ 実装済み |
| 物販管理 | 購入記録の登録・一覧 | ✅ 実装済み |
| 回数券管理 | チケット登録・消化管理・有効期限 | ✅ 実装済み |
| メニュー管理 | CRUD・カテゴリ・所要時間・料金 | ✅ 実装済み |
| 営業時間 | 曜日別の営業/休業・開閉店時間管理 | ✅ 実装済み |
| その他 | 離脱顧客アラート（60日/90日） | ✅ 実装済み |
| | スケルトンスクリーン（4画面） | ✅ 実装済み |
| | キャッシュヘッダー最適化 | ✅ 実装済み |
| | セキュリティヘッダー（CSP等） | ✅ 実装済み |

### 画面一覧（17ルート）

- `/dashboard` - ダッシュボード
- `/customers` - 顧客一覧
- `/customers/new` - 顧客新規登録
- `/customers/[id]` - 顧客詳細
- `/customers/[id]/edit` - 顧客編集
- `/customers/[id]/purchases/new` - 物販購入記録
- `/customers/[id]/tickets/new` - コースチケット登録
- `/appointments` - 予約一覧
- `/appointments/new` - 予約新規登録
- `/appointments/[id]/edit` - 予約編集
- `/records/new` - 施術記録作成
- `/records/[id]` - 施術記録詳細
- `/records/[id]/edit` - 施術記録編集
- `/settings` - 設定
- `/settings/menus` - メニュー管理
- `/settings/business-hours` - 営業時間設定
- `/guide` - 使い方ガイド

---

## 2. 競合調査

### 価格比較サマリー

| サービス | 月額（個人想定） | 初期費用 | カルテ | 予約 | 回数券 | LINE | 在庫 | HP/EC | 確定申告 | ターゲット |
|---------|-----------------|---------|-------|------|-------|------|------|-------|---------|-----------|
| Bionly FREE | 0円 | 0円 | ○(制限) | ○ | - | - | - | - | - | 美容室/エステ |
| LiME 無料 | 0円 | 0円 | 5枚/人 | 5件/月 | - | - | - | - | - | 美容師 |
| Square 予約 | 0~3,300円 | 0円 | x | ○ | - | - | ○ | - | - | 全業種 |
| **salon-karte** | **2,980円** | **0円** | **○無制限** | **○** | **○** | **計画中** | **計画中** | **計画中** | **計画中** | **エステ** |
| KaruteKun | 5,500円 | 0円 | ○ | ○ | - | +5,500円 | - | - | - | サロン全般 |
| Bionly 有料 | 10,780円 | 0円 | ○ | ○ | - | - | ○ | - | - | 美容室/エステ |
| BeSALO | 要問合 | 要問合 | ○ | ○ | ○ | ○ | ○ | - | - | 大規模 |
| サロンアンサー | 10,780円~ | 130,000円 | ○ | ○ | - | +6,800円 | - | - | - | 美容室 |
| リザービア | 21,000円~ | 100,000円 | 簡易 | ○ | - | +4,500円 | - | - | - | サロン全般 |
| Salon.EC | 0円 | 0円 | - | - | - | - | ○ | EC | - | EC特化 |

### 市場の隙間（salon-karteが狙えるポジション）

1. **カルテ+予約+回数券+物販** を2,980円で提供 → 競合に同等プランなし
2. **在庫管理** まで対応するカルテ管理は BeSALO（高価格帯）しかない
3. **HP+Web予約+SEO** を一体提供するカルテ管理は存在しない
4. **EC+カルテ連動** は市場に存在しない（Salon.ECはカルテ非対応）
5. **確定申告サポート（売上原価・棚卸明細の自動集計）** を提供するカルテ管理は **皆無**

→ **「カルテから在庫・HP・ECまで全てつながり、確定申告もラクになる」= 唯一無二のポジション**

---

## 3. 料金プラン設計（v2 — 2026-02-21改訂）

> 詳細な技術設計・損益分析は `docs/pricing-plan-spec.md` を参照

### 設計コンセプト: 「選ばなくていい。使うだけ。」

v1ではオプション7個のアラカルト方式だったが、調査の結果以下の理由で廃止:
- サロン業務は機能間連携が密 → 単独課金に向かない
- ターゲットのITリテラシーが低い → 5個超の選択肢で判断放棄
- 確定申告・CSV出力への課金 → 「データ人質」感で口コミリスク

### スタンダードプラン: 2,980円/月（税込・全機能込み）

| 含まれる機能 | 競合との優位性 |
|------------|-------------|
| 電子カルテ（枚数無制限） | LiME無料は5枚/人制限 |
| ビフォーアフター写真（5GB） | エステ特化の差別化ポイント |
| 顧客管理（人数無制限） | Bionly FREEはスタッフ1名制限 |
| 予約管理（無制限） | KaruteKunと同等 |
| 施術メニュー管理 | 複数メニュー選択対応 |
| 物販購入履歴 | **競合の大半が未対応** |
| 回数券・コース管理 | **エステの売上の柱。ほぼ全競合が未対応** |
| 在庫管理 | **2,980円に込み（BeSALOは高価格帯のみ）** |
| 確定申告レポート+CSV出力 | **競合ゼロの唯一無二の差別化** |
| 月間売上集計（施術+物販+回数券） | 3軸の集計は独自 |
| 離脱顧客アラート | 60日/90日で自動検出 |
| 来店分析 | 来店回数・間隔・最終来店日 |
| LINE連携（将来実装） | KaruteKun +5,500円 → 込みなら圧倒的優位 |
| カウンセリングシート（将来実装） | coming-soon標準搭載相当 |

### おためしプラン: 0円

| 機能 | 制限 |
|------|------|
| 顧客管理 | 10件まで |
| 予約管理 | 月10件まで |
| 写真保存 | なし |
| 売上レポート | 当月のみ |
| その他（カルテ・物販・在庫・確定申告・CSV） | 制限なし |

> リバーストライアル方式: 新規登録後30日間はスタンダード全機能開放 → 31日目に縮退

### 別プロダクト料金（将来）

| プロダクト | 月額 | 初期費用 | 備考 |
|-----------|------|---------|------|
| salon-site（HP+Web予約） | 3,980円/月 | 0円 | SEO最適化済み |
| salon-ec（ECサイト） | 2,980円/月 | 0円 | カルテ顧客連動 |
| セット割（カルテ+HP+EC） | 7,980円/月 | 0円 | 通常9,940円 → 約20%OFF |

> オプション機能の個別課金は廃止。追加収益は独立した価値を持つ別プロダクトで実現。

### 料金シミュレーション

```
パターン1「カルテだけ使いたい」
  スタンダードプラン = 2,980円（全機能込み）

パターン2「カルテ + HP（ホットペッパー脱却）」
  salon-karte + salon-site = 6,960円
  → ホットペッパー月2.5万～ の1/4以下

パターン3「全部入り（カルテ+HP+EC）」
  セット割 = 7,980円
  → リザービア(21,000円+初期10万) やサロンアンサー(10,780円+初期13万) より安い
  → しかも初期費用0円・オプション追加課金なし
```

### 損益分岐

| 条件 | 必要サロン数 | 月売上 |
|------|-----------|--------|
| 運用費のみ回収（Supabase+Vercel） | 3サロン | 8,940円 |
| 全コスト回収（+Claude Max 20x $200） | 13サロン | 38,740円 |
| 全コスト回収（Claude Pro $20に切替後） | 4サロン | 11,920円 |
| 月10万円利益 | 48サロン | 143,040円 |

---

## 4. 差別化ポイント

### 1. エステ特化のカルテ機能
- 競合の大半は美容室（ヘアサロン）向け
- ビフォーアフター写真管理、施術前の状態記録、肌の経過記録
- エステサロンに必要な情報項目を標準装備

### 2. 初期費用0円 + 月額2,980円
- リザービア: 初期10万 + 月2.1万
- サロンアンサー: 初期13万 + 月1万
- coming-soon: 初期3.3万 + 月1.4万
- → salon-karteは0円スタートで圧倒的に導入しやすい

### 3. 回数券・物販管理が基本機能
- エステでは回数券が売上の柱
- 物販（化粧品・サプリ等）も重要な収益源
- これらが基本料金に含まれるのはほぼ唯一

### 4. エコシステム連携
- カルテ ↔ 在庫管理: 物販記録で自動在庫引落し
- カルテ ↔ HP: 顧客がWeb予約 → カルテの予約に自動反映
- カルテ ↔ EC: EC購入履歴 → カルテの顧客に自動紐付け
- **「ツールの掛け持ち不要」が個人サロンオーナーに最大の訴求力**

### 5. 確定申告がラクになる（競合ゼロの差別化）
- 物販の売上・仕入を記録するだけで、年末に確定申告用データが自動生成
- 期首/期末棚卸高、売上原価、月別売上・仕入を1クリックで出力
- freee/弥生にインポートできるCSV形式対応
- **個人サロンオーナーの年末の苦痛を劇的に削減 → 解約防止にも直結**

---

## 5. アーキテクチャ設計方針 — 3プロダクト体制

### 判断基準

| 判断軸 | 在庫管理 | HP+Web予約 | EC |
|-------|---------|-----------|-----|
| ユーザー | オーナー（同じ人） | オーナー + エンド顧客 | オーナー + エンド顧客 |
| 認証基盤 | 同じ（サロンオーナー） | 別（顧客は匿名/簡易認証） | 別（顧客はEC会員） |
| ドメイン | 管理系（B向け） | 公開系（C向け） | 公開系（C向け） |
| データ量 | 少～中（SKU数十点） | 中（ページ数） | 多（注文・決済・配送） |
| 法的要件 | なし | 特定商取引法 | 特定商取引法 + 決済PCI-DSS |
| 障害影響 | カルテと同時ダウンはNG | 独立させたい | 独立させたい |

### 結論

```
┌─────────────────────────────────────────────────┐
│                Supabase (共有DB)                  │
│   salons / customers / appointments / records    │
│   products / inventory_logs / orders / pages     │
├─────────────┬────────────────┬───────────────────┤
│ salon-karte │  salon-site    │    salon-ec       │
│ (カルテ管理)│ (HP+Web予約)   │   (ECサイト)      │
│ + 在庫管理  │                │                   │
│ + 確定申告  │                │                   │
│ Vercel App  │  Vercel App    │   Vercel App      │
│ /管理者専用  │ /公開サイト     │  /ECストア        │
└─────────────┴────────────────┴───────────────────┘
```

**在庫管理** → salon-karte 内のオプション機能として実装
- 理由: ユーザーが同じ（オーナー）、認証基盤も同じ、物販記録と直結
- テーブル追加: `products`（商品マスタ）+ `inventory_logs`（入出庫履歴）
- カルテの物販登録時に `inventory_logs` に自動出庫レコード挿入

**HP+Web予約 (salon-site)** → 別アプリ
- 理由: エンド顧客向けの公開ページ、認証が異なる、SEOが最重要
- 技術: Next.js SSG/ISR + サロンごとのサブドメイン or カスタムドメイン
- DB: Supabase の同じプロジェクト（読み取り中心、RLSで安全に分離）

**ECサイト (salon-ec)** → 別アプリ
- 理由: 決済処理、注文管理、配送管理など独立ドメイン
- 技術: Next.js + Stripe 決済 + Supabase
- DB: 同じ Supabase（customers テーブルを共有して顧客連動）

### データ連携の仕組み

```
[salon-karte] 物販登録 → purchases INSERT + inventory_logs INSERT (自動出庫)
  → 在庫数リアルタイム更新

[salon-karte] 仕入登録 → inventory_logs INSERT (入庫, 都度の仕入単価を記録)
  → 在庫数リアルタイム更新

[salon-site] Web予約 → appointments INSERT (status='pending')
  → salon-karte のダッシュボードにリアルタイム通知

[salon-ec] EC購入 → ec_orders INSERT
  → customers テーブルの顧客と紐付け
  → inventory_logs INSERT (自動出庫)
  → salon-karte の顧客詳細でEC購入履歴も表示

[salon-karte] 確定申告レポート → 全テーブルを集計して年次レポート生成
```

---

## 6. UI/UX改善計画

### 現状の課題分析

現在17ルートに成長し、以下の課題が顕在化:

| # | 課題 | 影響度 | 対象ユーザー |
|---|------|-------|------------|
| 1 | ボトムナビが4つしかなく、増えた機能への導線が不明確 | 高 | 全員 |
| 2 | 設定画面に機能が集中し始めている（営業時間、メニュー、今後も追加） | 中 | 全員 |
| 3 | 「施術記録」の作成導線がわかりにくい（顧客詳細からのみ） | 高 | 初心者 |
| 4 | ダッシュボードの情報密度が高く、初回で何をすればいいかわからない | 中 | 新規 |
| 5 | 機能の存在を知らない（離脱アラート、売上集計など） | 高 | 全員 |
| 6 | フォーム入力が多いページでの離脱リスク | 中 | 全員 |
| 7 | 戻る導線・パンくず的なナビゲーションがない | 中 | 全員 |

### 改善方針: 「迷わないUI」5原則

1. **1タップで目的地** — よく使う機能はホームから1タップ
2. **文脈ナビゲーション** — 今いる画面から次のアクションが自然に見える
3. **プログレッシブ開示** — 初心者には基本だけ見せ、慣れたら高度な機能を発見
4. **視覚的ガイド** — アイコン・色・バッジで状態を即座に理解
5. **安心フィードバック** — 保存成功・エラー・未保存状態を明確に

### 具体的な改善施策

#### A. ナビゲーション改善（最優先）

```
【現状のボトムナビ】
[ホーム] [予約] [顧客] [設定]

【改善案】
[ホーム] [予約] [+新規] [顧客] [メニュー]
                 ↑
         FAB (Floating Action Button)
         タップで展開:
         ├ 予約を追加
         ├ カルテを書く
         ├ 物販を記録
         └ 顧客を登録
```

- **FAB（＋ボタン）** を中央に配置 → 主要アクションの入口を1箇所に集約
- 設定はヘッダーのギアアイコンに移動（毎日使うものではない）
- 「メニュー」ボタンは「もっと」に変更して、設定・ガイド・在庫管理・ログアウト等を格納する案も検討

#### B. ダッシュボード改善

```
【現状】
- 今日の予約リスト
- 売上サマリー
- 離脱顧客アラート
- 最近のカルテ

【改善案】
1. 「おはようございます、○○サロンさん」の挨拶
2. 今日のやることカード
   - 「今日の予約: 3件」 → タップで予約一覧
   - 「フォローが必要な顧客: 2名」 → タップで該当顧客
   - 「在庫残りわずか: 1商品」 → タップで在庫一覧（在庫オプション有効時）
3. クイックアクション（大きなカード型ボタン）
   - 「予約を入れる」「カルテを書く」「売上を見る」
4. 今日の予約タイムライン（シンプル版）
```

#### C. 初回ガイド（オンボーディング）

```
初回ログイン時のステップバイステップ:

Step 1: 「まず営業時間を設定しましょう」→ /settings/business-hours
Step 2: 「メニューを登録しましょう」→ /settings/menus
Step 3: 「お客様を1名登録してみましょう」→ /customers/new
Step 4: 「準備完了！ダッシュボードに戻る」→ /dashboard

各ステップに ✓ チェックマーク → 進捗が見える
スキップ可能（「あとで設定する」ボタン）
```

#### D. パンくずナビ + 戻るボタン

```
[← 顧客一覧] > 山田花子 > カルテ #5

各ページのヘッダーに:
- ← 戻るボタン（前のページ）
- パンくず（現在位置の把握）
```

#### E. フォーム改善

- 長いフォームをステップ分割（特に顧客新規登録）
- 必須項目を最小限に、任意項目は「詳細を追加」で展開
- 入力中の自動保存（ドラフト機能）
- バリデーションエラーは入力フィールドの直下に即座表示

#### F. 機能ディスカバリー

- 初回利用時のツールチップ（「ここをタップすると離脱顧客が見えます」）
- ダッシュボードに「便利な機能」カード（週替わりで1つずつ紹介）
- 使われていない機能へのやさしいナッジ

---

## 7. 在庫管理 詳細設計

### 7-1. 商品マスタ（products テーブル）

```sql
CREATE TABLE products (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  salon_id UUID NOT NULL REFERENCES salons(id),
  name TEXT NOT NULL,                    -- 商品名（例: 「モイスチャー美容液」）
  category TEXT,                         -- カテゴリ（例: 「スキンケア」「ヘアケア」「サプリ」）
  sku TEXT,                              -- 管理番号（任意）
  base_sell_price INTEGER NOT NULL,      -- 基本売単価（通常販売価格）
  base_cost_price INTEGER NOT NULL,      -- 基本仕入単価（通常仕入価格）
  reorder_point INTEGER DEFAULT 3,       -- 発注点（この数以下で警告）
  is_active BOOLEAN DEFAULT true,        -- 取扱中フラグ
  memo TEXT,                             -- メモ
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

**ポイント**:
- `base_sell_price` / `base_cost_price` = マスタ上の「いつもの価格」
- 実際の取引では都度の価格を記録（下記 inventory_logs / purchases で管理）
- `reorder_point` = 在庫がこの数以下になったら警告表示

### 7-2. 在庫入出庫ログ（inventory_logs テーブル）

```sql
CREATE TABLE inventory_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  salon_id UUID NOT NULL REFERENCES salons(id),
  product_id UUID NOT NULL REFERENCES products(id),
  log_type TEXT NOT NULL,                -- 'purchase_in'  = 仕入（入庫）
                                         -- 'sale_out'     = 店頭販売（自動出庫）
                                         -- 'ec_out'       = EC販売（自動出庫）
                                         -- 'sample_out'   = サンプル使用・開封
                                         -- 'waste_out'    = 破損・廃棄
                                         -- 'adjust'       = 棚卸し調整
                                         -- 'return_in'    = 返品（入庫）
  quantity INTEGER NOT NULL,             -- 増減数（入庫=正, 出庫=負）
  unit_cost_price INTEGER,               -- この取引の仕入単価（入庫時のみ）
  unit_sell_price INTEGER,               -- この取引の売単価（販売時のみ）
  reason TEXT,                           -- 理由メモ（サンプル/廃棄/調整の場合必須）
  related_purchase_id UUID,              -- 関連する物販記録ID（店頭販売時）
  related_order_id UUID,                 -- 関連するEC注文ID（EC販売時）
  logged_at TIMESTAMPTZ DEFAULT now(),   -- 記録日時
  created_at TIMESTAMPTZ DEFAULT now()
);
```

### 7-3. 在庫増減パターン一覧

| パターン | log_type | quantity | unit_cost_price | unit_sell_price | トリガー |
|---------|----------|----------|-----------------|-----------------|---------|
| 仕入れ | `purchase_in` | +N | 都度の仕入単価 | — | 手入力 |
| 店頭販売 | `sale_out` | -N | — | 都度の売単価 | 物販登録で自動 |
| EC販売 | `ec_out` | -N | — | EC販売価格 | EC注文で自動（将来） |
| サンプル使用 | `sample_out` | -N | — | 0 | 手入力（理由メモ付き） |
| 破損・廃棄 | `waste_out` | -N | — | 0 | 手入力（理由メモ付き） |
| 棚卸し調整 | `adjust` | ±N | — | — | 棚卸し画面で入力 |
| 返品（顧客→サロン） | `return_in` | +N | — | -売価 | 手入力 |

### 7-4. 価格管理の考え方

```
【マスタ価格 vs 都度価格】

商品マスタ:
  美容液A → 基本売価: 3,000円 / 基本仕入価: 1,200円

仕入時:
  「今月はキャンペーンで安く仕入れた」
  → 入庫ログに unit_cost_price: 800円 と記録
  → マスタの基本仕入価は変わらない（通常に戻ったらそのまま使える）

販売時:
  「お客様にキャンペーン価格で販売」
  → 物販記録 + 出庫ログに unit_sell_price: 2,500円 と記録
  → マスタの基本売価は変わらない

サンプル・廃棄:
  → unit_sell_price: 0円（売上にならない）
  → 在庫だけ減る

粗利計算:
  各取引の粗利 = unit_sell_price - (その商品の最終仕入単価)
  → 最終仕入原価法に基づく（確定申告で使う標準的な方法）
```

### 7-5. 物販登録時の自動連動フロー

```
【オーナーが「物販を記録」する時の画面フロー】

1. 顧客を選択
2. 商品を選択（商品マスタから）
   → 基本売価 3,000円 が自動セット
3. 「今回の売価」を確認/変更
   → キャンペーン中なら 2,500円 に手で変更
4. 数量を入力（デフォルト: 1）
5. 「記録する」ボタン

裏側で起きること:
  ① purchases テーブルに記録 INSERT（sell_price = 2,500, cost_price = 最終仕入単価）
  ② inventory_logs に出庫ログ INSERT（log_type='sale_out', quantity=-1）
  ③ 在庫数リアルタイム更新（SUM(quantity) で常に最新値を計算）
  ④ もし在庫 ≤ 発注点 → ダッシュボードに「残りわずか」アラート
```

### 7-6. 既存 purchases テーブルの拡張

```sql
-- 既存の purchases テーブルに以下カラムを追加
ALTER TABLE purchases ADD COLUMN product_id UUID REFERENCES products(id);
ALTER TABLE purchases ADD COLUMN cost_price INTEGER;      -- この取引の仕入原価
ALTER TABLE purchases ADD COLUMN sell_price INTEGER;       -- この取引の売価（既存 unit_price を rename）

-- product_id は任意（商品マスタにない自由入力の物販もそのまま対応）
-- product_id がある場合のみ在庫連動が動作
```

### 7-7. 棚卸し機能

```
【12/31 棚卸しの画面フロー】

「棚卸しを開始」ボタン → 全商品の一覧表示

  商品名       | システム在庫 | 実際の在庫 | 差分
  美容液A      |    12個     | [  12  ]  |  0
  クリームB    |     8個     | [   7  ]  | -1 ← 自動計算
  サプリC      |     5個     | [   5  ]  |  0

差分がある商品は inventory_logs に adjust レコードが自動生成
理由メモ: 「2026年12月期 棚卸し調整」

「棚卸しを確定」ボタン → 棚卸し日時と結果を保存
→ 確定申告レポートの期末棚卸高に反映
```

### 7-8. 確定申告サポート機能

#### 背景: 個人事業主の確定申告で必要な数字

物販をしているサロンは **棚卸しが確定申告で必須**。
青色申告決算書の「売上原価」セクションに以下を記入する必要がある:

```
  期首商品棚卸高    ← 1月1日時点の在庫金額（仕入原価ベース）
＋ 当期仕入高       ← 年間の仕入れ総額
－ 期末商品棚卸高    ← 12月31日時点の在庫金額（仕入原価ベース）
＝ 売上原価         ← 自動計算
```

評価方法は **「最終仕入原価法」**（その年の最後の仕入単価 × 期末在庫数）が原則。

#### 確定申告レポートの出力内容

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  2026年（令和8年）確定申告用データ
  サロン名: ○○エステサロン
  出力日: 2027-02-01
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

■ 売上原価の計算（青色申告決算書 第1ページ対応）
  ┌──────────────────────────────────┐
  │ 期首商品棚卸高:     120,000円   │ ← 前年12/31の棚卸し結果
  │ 当期仕入高:         480,000円   │ ← 年間の仕入合計（自動集計）
  │ 期末商品棚卸高:     150,000円   │ ← 今年12/31の棚卸し結果
  │ ─────────────────────────────── │
  │ 売上原価:           450,000円   │ ← 自動計算
  └──────────────────────────────────┘

■ 売上内訳（月別売上金額 対応）
  ┌────┬──────────┬──────────┬──────────┬──────────┐
  │ 月 │ 施術売上  │ 物販売上  │ 回数券   │   合計    │
  ├────┼──────────┼──────────┼──────────┼──────────┤
  │  1 │  200,000 │   50,000 │  30,000 │  280,000 │
  │  2 │  180,000 │   45,000 │  30,000 │  255,000 │
  │ .. │    ...   │    ...   │   ...   │    ...   │
  │ 12 │  220,000 │   55,000 │  30,000 │  305,000 │
  ├────┼──────────┼──────────┼──────────┼──────────┤
  │合計│2,400,000 │  600,000 │ 360,000 │3,360,000 │
  └────┴──────────┴──────────┴──────────┴──────────┘

■ 月別仕入金額（青色申告決算書 第2ページ対応）
  ┌────┬──────────┐
  │ 月 │ 仕入金額  │
  ├────┼──────────┤
  │  1 │   40,000 │
  │  2 │   35,000 │
  │ .. │    ...   │
  │ 12 │   45,000 │
  ├────┼──────────┤
  │合計│  480,000 │
  └────┴──────────┘

■ 期末棚卸明細（最終仕入原価法）
  ┌────────────────┬──────┬────────────┬──────────┐
  │ 商品名          │ 在庫 │ 最終仕入単価 │   金額   │
  ├────────────────┼──────┼────────────┼──────────┤
  │ モイスチャー美容液│  5個 │    1,200円 │   6,000 │
  │ リペアクリーム   │ 10個 │      800円 │   8,000 │
  │ コラーゲンサプリ │  8個 │    1,500円 │  12,000 │
  │ ...             │  ... │       ...  │     ... │
  ├────────────────┼──────┼────────────┼──────────┤
  │ 合計            │      │            │ 150,000 │
  └────────────────┴──────┴────────────┴──────────┘

■ 粗利サマリー（参考情報）
  物販売上:          600,000円
  物販原価:          450,000円
  物販粗利:          150,000円（粗利率 25.0%）

■ 在庫変動サマリー
  仕入:              +480個
  店頭販売:          -420個
  サンプル/開封:      -15個
  破損・廃棄:         -3個
  棚卸し調整:         -2個
```

#### 出力形式

| 形式 | 用途 |
|------|------|
| 画面表示 | アプリ内で確認（いつでも閲覧可能） |
| PDF | 印刷して税理士に渡す用 |
| CSV（freee形式） | freeeにインポート |
| CSV（弥生形式） | 弥生会計にインポート |
| CSV（汎用） | その他の会計ソフト用 |

#### 年間カレンダー（オーナーへのリマインド）

```
12月上旬: 「年末棚卸しの準備」通知
12月31日: 「棚卸しを行ってください」通知 → 棚卸し画面への直リンク
1月上旬: 「確定申告レポートが出力できます」通知
2月16日: 「確定申告期限まであと1ヶ月」通知
3月10日: 「確定申告期限まであと5日」通知
```

### 7-9. 在庫管理の追加画面一覧

| ルート | 画面 | 内容 |
|-------|------|------|
| `/inventory` | 在庫一覧 | 全商品の現在庫・発注点アラート |
| `/inventory/products` | 商品マスタ | 商品の追加・編集・削除 |
| `/inventory/products/new` | 商品追加 | 商品名・基本売価・基本仕入価 |
| `/inventory/products/[id]/edit` | 商品編集 | |
| `/inventory/receive` | 仕入（入庫） | 商品選択・数量・都度仕入単価 |
| `/inventory/consume` | サンプル/廃棄 | 商品選択・数量・理由メモ |
| `/inventory/stocktake` | 棚卸し | 全商品の実数入力・差分調整 |
| `/inventory/report` | 確定申告レポート | 年度選択 → レポート表示・出力 |

---

## 8. 開発ロードマップ（改訂版）

### Phase 4.0: UI/UX改善 ✅ 完了

| # | 施策 | 状態 |
|---|------|------|
| 4-1 | ナビゲーション再設計（FAB + ヘッダー設定） | ✅ 実装済み |
| 4-2 | ダッシュボード改善（挨拶・クイックアクション・タスクカード） | ✅ 実装済み |
| 4-3 | パンくずナビ + 戻るボタン全ページ対応 | ✅ 実装済み |
| 4-4 | 初回オンボーディングフロー | ✅ 実装済み（setup + onboarding-checklist + guide） |
| 4-5 | フォームUX改善（自動保存 + プログレッシブ開示） | ✅ 実装済み（useFormDraft + CollapsibleSection） |
| 4-6 | 機能ディスカバリー | ✅ 実装済み（feature-tip + ガイドページ） |

> ステップ分割（ウィザード形式）はモバイルファーストのUXに不適合のため不採用。
> スクロール型 + 折りたたみセクションの方がタップ数が少なく業務効率が高い。

### Phase 5.0: 在庫管理 + 確定申告サポート ✅ 完了

| # | 施策 | 状態 |
|---|------|------|
| 5-1 | 商品マスタ CRUD | ✅ 実装済み |
| 5-2 | 在庫入出庫ログ | ✅ 実装済み |
| 5-3 | 物販登録 → 自動出庫連動 | ✅ 実装済み |
| 5-4 | 在庫一覧ダッシュボード | ✅ 実装済み |
| 5-5 | 仕入・サンプル消費・廃棄 | ✅ 実装済み |
| 5-6 | 棚卸し機能 | ✅ 実装済み |
| 5-7 | 確定申告レポート | ✅ 実装済み |
| 5-8 | CSV出力 | ✅ 実装済み（確定申告レポート内） |

### Phase 6.0: カルテ追加機能

| # | 施策 | 工数目安 |
|---|------|---------|
| 6-1 | カウンセリングシート（テンプレート作成 + 回答管理） | 1.5日 |
| 6-2 | LINE連携（Messaging API + リマインド自動送信） | 2日 |
| 6-3 | CSV エクスポート | 0.5日 |
| 6-4 | カルテPDF出力 | 1日 |
| 6-5 | 詳細分析レポート（グラフ + LTV算出） | 1.5日 |
| | **小計** | **6.5日** |

### Phase 7.0: salon-site（HP+Web予約 — 別アプリ）

| # | 施策 | 工数目安 |
|---|------|---------|
| 7-1 | プロジェクトセットアップ（Next.js + Supabase共有） | 0.5日 |
| 7-2 | テンプレートエンジン（サロン情報からHP自動生成） | 2日 |
| 7-3 | SEO最適化（構造化データ・メタ・sitemap・OGP） | 1日 |
| 7-4 | Web予約フォーム（空き枠連動） | 2日 |
| 7-5 | Google ビジネスプロフィール連携（MEO対策） | 1日 |
| 7-6 | カスタムドメイン対応 | 0.5日 |
| 7-7 | デザインカスタマイズ（カラー・写真・テキスト） | 1日 |
| 7-8 | お知らせ・ブログ機能（コンテンツSEO） | 1.5日 |
| | **小計** | **9.5日** |

### Phase 8.0: salon-ec（ECサイト — 別アプリ）

| # | 施策 | 工数目安 |
|---|------|---------|
| 8-1 | プロジェクトセットアップ（Next.js + Stripe + Supabase） | 1日 |
| 8-2 | 商品カタログ（salon-karteの商品マスタ連動） | 1日 |
| 8-3 | カート + Stripe Checkout 決済 | 2日 |
| 8-4 | 注文管理画面（管理側） | 1日 |
| 8-5 | 顧客連動（EC会員 ↔ カルテ顧客の紐付け） | 1日 |
| 8-6 | 在庫連動（EC売上 → 在庫自動減算） | 0.5日 |
| 8-7 | 配送管理（ステータス追跡） | 1日 |
| 8-8 | SEO + OGP + 構造化データ | 0.5日 |
| 8-9 | 特定商取引法ページ | 0.5日 |
| | **小計** | **8.5日** |

---

## 9. 各プロダクト仕様・見積もり

### A. salon-karte（カルテ管理 — 既存アプリ強化）

**対象**: UI/UX改善 + 在庫管理（確定申告サポート込み）+ 追加機能

| 項目 | 内容 |
|------|------|
| 工数 | Phase 4: 5日 + Phase 5: 5日 + Phase 6: 6.5日 |
| 合計 | **約16.5日（3〜3.5週間）** |
| 追加月額収益 | 在庫管理 +500円, カウンセリング +500円, LINE +1,500円 等 |
| 技術リスク | 低（既存基盤の拡張） |

### B. salon-site（HP+Web予約 — 新規アプリ）

| 項目 | 内容 |
|------|------|
| コンセプト | 「ホットペッパーに負けないSEO × 月額3,980円」 |
| 工数 | Phase 7: **約9.5日（2週間）** |
| SEO戦略 | 下記参照 |
| 月額収益 | 3,980円/サロン |
| 技術リスク | 中（マルチテナント・カスタムドメイン） |

#### SEO戦略 — ホットペッパーに勝つための方針

ホットペッパーは「地域名 × エステ」でドメインパワーにより上位を独占。
しかし個別サロンの「固有名詞」「施術特化キーワード」では十分に勝てる。

```
勝てるキーワード:
  「[サロン名]」「[サロン名] 口コミ」「[サロン名] 予約」
  「[地域名] フェイシャルエステ 個人サロン」
  「[地域名] 毛穴ケア 専門」
  「[施術名] 効果 [地域名]」

技術的SEO:
  - Next.js SSG/ISR → Core Web Vitals 完全クリア
  - JSON-LD 構造化データ（LocalBusiness, Service, FAQPage）
  - 動的 sitemap.xml 自動生成
  - OGP / Twitter Card 完全対応
  - モバイルファースト（Google モバイルインデックス対応）

コンテンツSEO:
  - サロン紹介ページ（USP・こだわり・スタッフ紹介）
  - 施術メニュー詳細ページ（各メニューで1ページ = 検索対象倍増）
  - ブログ/お知らせ機能（定期更新でクローラー頻度UP）
  - ビフォーアフター事例集（カルテ写真をHP公開用に転用）
  - FAQ ページ（FAQPage構造化データで検索結果にリッチ表示）

MEO対策:
  - Google ビジネスプロフィールとの連携
  - 住所・営業時間の構造化データ
  - Google Maps 埋め込み
  - 口コミ誘導フロー
```

### C. salon-ec（ECサイト — 新規アプリ）

| 項目 | 内容 |
|------|------|
| コンセプト | 「カルテの顧客にそのまま売れるEC」 |
| 工数 | Phase 8: **約8.5日（1.5〜2週間）** |
| 月額収益 | 2,980円/サロン |
| 決済 | Stripe（決済手数料 3.6%） |
| 技術リスク | 中高（決済・特商法・在庫同期） |

#### カルテ連動の具体的メリット

```
1. 顧客が来店 → 施術中に商品を勧める → その場で購入記録（カルテ側）
2. 帰宅後リピート購入 → ECサイトで注文 → 同じ顧客に紐付け
3. オーナーは1つのダッシュボードで店頭+EC売上を一括把握
4. 在庫は店頭販売もEC販売も同じプールで管理 → 欠品防止
5. EC購入顧客に「次回来店時10%OFF」→ 来店誘導にも活用
```

### 見積もり総括

| プロダクト | 工数 | 月額収益/サロン | 優先順位 |
|-----------|------|---------------|---------|
| salon-karte 強化（UI/UX + 在庫 + 確定申告） | — | 2,980円 | ✅ 完了 |
| salon-karte 追加機能（Phase 6） | 約6.5日 | 2,980円 | ★★★ 次に着手 |
| salon-site（HP+Web予約） | 約9.5日 | 3,980円 | ★★ その次 |
| salon-ec（ECサイト） | 約8.5日 | 2,980円 | ★ その次 |
| **残り合計** | **約24.5日** | **最大 9,940円/サロン** | |

```
実績 + 想定タイムライン:
  2月:         Phase 1-3（コア機能）           完了
  2月:         Phase 4（UI/UX改善）            完了
  2月:         Phase 5（在庫管理+確定申告）     完了
  次に着手:    Phase 6（カルテ追加機能）        6.5日
  その後:      Phase 7（salon-site）           9.5日
  その後:      Phase 8（salon-ec）             8.5日
```

---

## 10. 技術スタック

### 共通基盤

| レイヤー | 技術 |
|---------|------|
| フロントエンド | Next.js 15 (App Router) + TypeScript + Tailwind CSS 4 |
| バックエンド | Supabase (PostgreSQL + Auth + Storage + Realtime) |
| ホスティング | Vercel |
| DB | 10マイグレーション、9テーブル（+products, inventory_logs 追加予定）、1 RPC関数 |

### salon-site 追加技術

| 技術 | 用途 |
|------|------|
| Next.js SSG/ISR | SEOのための静的生成 |
| JSON-LD | 構造化データ（LocalBusiness, Service） |
| Vercel Domains API | カスタムドメイン対応 |

### salon-ec 追加技術

| 技術 | 用途 |
|------|------|
| Stripe Checkout / Payment Intents | 決済処理 |
| Stripe Webhooks | 注文ステータス同期 |
| Supabase Edge Functions | Webhook 受信・在庫同期 |

---

## 補足: 参考リンク

- [エステサロンのSEO対策完全ガイド（2026年版）](https://devo.jp/seolaboratory/104327/)
- [美容室のSEOはコンテンツSEOが最適](https://ledeal.co.jp/info/beautysalon-seo-va/)
- [Salon.EC — 美容サロン向けECサービス](https://salon.ec/)
- [BeSALO — 在庫管理機能付きサロン管理](https://www.be-salo.com/)
- [2026年版 サロン予約システム比較](https://notepm.jp/blog/11512)
- [Next.js Beauty Salon Website Template](https://www.webbytemplate.com/product/leonie-nextjs-beauty-salon-website-template/)
- [エステサロン開業の確定申告ガイド](https://www.felicite-kobe.net/column/archives/5336)
- [個人事業主の棚卸資産について](https://www.zeitetsuzuki.jp/15663628684836)
- [freee 棚卸資産の残高登録方法](https://support.freee.co.jp/hc/ja/articles/202849130)
- [個人事業主は在庫に注意 — 在庫の数で税金が変わる](https://www.all-senmonka.jp/moneyizm/management/1213/)
- [美容室の帳簿の付け方](https://www.b-merit.jp/magazine/beautysalonbookkeeping/)
